<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>카카오톡 분석</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://uicdn.toast.com/tui.chart/latest/tui-chart.min.css">
</head>

<body>
  <div id="chart-area"></div>

  <div class="container current" id="start">
    <svg width="100%" viewBox="0 0 1024 755" version="1.1" xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/"
      style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;" id="clip">
      <g id="Artboard1" transform="matrix(1,0,0,0.697967,0,0)">
        <rect x="0" y="0" width="1024" height="1024" style="fill:none;" />
        <g transform="matrix(1,0,0,1.43273,0,0)">
          <path d="M0,714.718L0,0L1024,0L1024,376.49C1024,376.49 271.02,363.809 0,714.718Z"
            style="fill:rgb(235,212,212);" />
        </g>
      </g>
    </svg>

    <div id="content">
      <div>
        <p id="subtitle">2020 Redesign</p>
        <p class="title">카카오톡 분석</p>
      </div>
      <div class="buttoncon">
        <div class="button">
          <a href="#input">시작하기</a>
        </div>
      </div>
    </div>
  </div>
  <div class="container" id="input">
    <h1 class="pagetitle">대화 내용을 입력해주세요</h1>
    <div class="content">
      <div id="file">
        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" id="clip">
          <path d="M0 0h24v24H0V0z" fill="none" />
          <path fill="#FF9D9D"
            d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z" />
        </svg>
        <p>파일로 올리기</p>
      </div>
      <div id="textInput">
        <textarea placeholder="직접 입력" id="chatlog"></textarea>
      </div>
    </div>
    <div class="buttoncon">
      <div class="button" id="analysis">
        <a href="#view_chart">
          분석하기
        </a>
      </div>
    </div>
  </div>
  <div class="container" id="view_chart">
    <div id="chart"></div>
    <div class="buttoncon">
      <div class="button" id="download">내려받기</div>
    </div>
  </div>
  <!-- <script src="https://uicdn.toast.com/tui.chart/latest/tui-chart.min.js"></script> -->
  <script src="./node_modules/tui-chart/dist/tui-chart-all.js"></script>
  <script type="text/javascript">
    function analysis(chats) {
      const users = [...new Set(chats.match((/, .*? : /g)).map(e => e.slice(2, -3)))];
      const chatQuantityByUser = users.reduce((obj, i) => ({
        ...obj,
        [i]: chats.split(i).length - 1
      }), {})
      return chatQuantityByUser
    }
    function drawChart(draweeData) {
      const chart = document.getElementById('chart')
      tui.chart.columnChart(chart, {
        categories: Object.keys(draweeData),
        series: [
          {
            name: '채팅 수',
            data: Object.values(draweeData)
          }
        ]
      }, {
        chart: {
          width: 640,
          height: 540,
          format: '1,000'
        },
        yAxis: {
          title: '갯수',
        },
        xAxis: {
          title: '이름'
        },
        legend: {
          visible: false
        }
      });

    }
    [...document.getElementsByClassName('move-page')].map(e => e.addEventListener('click', () => goto(Number(e.dataset.goto))))
    document.getElementById('analysis').addEventListener('click', () =>
      drawChart(analysis(document.getElementById('chatlog').value))
    )
    document.getElementById('download').addEventListener('click', () => document.querySelector("#csv").click())
    if (location.pathname === '/') location.href = '#start'
  </script>

</body>

</html>